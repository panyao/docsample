

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="scala" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="scala" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>A Multi-Objective Optimization Problem &mdash; DuaLip 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="A Matching Problem" href="matching.html" />
    <link rel="prev" title="Demo" href="index.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> DuaLip
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../solver/index.html">The Dualip Solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfaces/index.html">Interfaces</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Demo</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">A Multi-Objective Optimization Problem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#an-example-problem">An example problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-translate-the-problem-mathematically">How to translate the problem mathematically?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-formulate-the-training-data">How to formulate the training data?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-execute-the-solver">How to execute the solver?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-spark">Install Spark</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-and-build-the-code">Get and build the code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-the-dataset">Get the dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-the-solver">Run the solver</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-read-the-results-and-do-inference">How to read the results and do inference?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="matching.html">A Matching Problem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../citing/index.html">Citing Dualip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgement/index.html">Acknowledgements</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DuaLip</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Demo</a> &raquo;</li>
        
      <li>A Multi-Objective Optimization Problem</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/demo/moo.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="a-multi-objective-optimization-problem">
<h1>A Multi-Objective Optimization Problem<a class="headerlink" href="#a-multi-objective-optimization-problem" title="Permalink to this headline">¶</a></h1>
<p>Multi-objective optimization problems (MOO) are optimization problems where more than one objective function needs to be optimized simultaneously. MOO appears frequently in machine learning and web applications where trade-offs between conflicting objective are needed. For example, balancing multiple business metrics in a ranking or recommendation system. MOO can be framed by considering one of the objectives as primary and others as constraints.</p>
<div class="section" id="an-example-problem">
<h2>An example problem<a class="headerlink" href="#an-example-problem" title="Permalink to this headline">¶</a></h2>
<p>We consider <a class="reference external" href="https://www.kdd.org/kdd2016/papers/files/adf0710-guptaA.pdf">volume optimization</a> as an example to demonstrate how to solve a Multi-Objective Optimization Problem.
A core problem in any internet industry is to send out emails and notifications to the users,
either for marketing purposes, for gaining user attention, or to bring users back to the platform. They help in the
quick distribution of information, but too many emails or notifications are not preferable as they may lead bad user
experience.</p>
<p>The problem to be solved can be stated as: given a set of email/notificaiton, find a strategy of sending/dropping to maximize the overall session,
such that the total number of emails or notifications that are sent is bounded, the overall click rate is above a threshold and the total disable rate is bounded as well.</p>
</div>
<div class="section" id="how-to-translate-the-problem-mathematically">
<h2>How to translate the problem mathematically?<a class="headerlink" href="#how-to-translate-the-problem-mathematically" title="Permalink to this headline">¶</a></h2>
<p>To translate this problem mathematically, let us begin with some notations. Define</p>
<ul class="simple">
<li><span class="math notranslate nohighlight">\(x_{ik}\)</span>: Probability of sending the j-th email or notification to the i-th user.</li>
<li><span class="math notranslate nohighlight">\(c_{ik}\)</span>: Probability of user visit the site if this email/notification is sent.</li>
<li><span class="math notranslate nohighlight">\(p_{ik}\)</span>: Probability of user click this email/notification.</li>
<li><span class="math notranslate nohighlight">\(r_{ik}\)</span>: Probability of user disable/unsubscribe this email/notification.</li>
</ul>
<p>The optimization problem can be written as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{ll}
  \mbox{Maximize} &amp; \sum_{ik} x_{ik} c_{ik} &amp;\\
  \mbox{subject to} &amp; \sum_{ik} x_{ik} \leq c_1 &amp; \text{Sends are bounded} \\
  &amp; \sum_{ik} x_{ik} p_{ik} \geq c_2 &amp; \text{Clicks above a threshold} \\
  &amp; \sum_{ik} x_{ik} r_{ik} \leq c_3 &amp; \text{Disables below a threshold} \\
  &amp; 0 \leq x \leq 1 &amp; \text{Probability constraint} \\
\end{array}\end{split}\]</div>
<p>We can further frame this using vector and matrix notation.</p>
<ol class="arabic">
<li><p class="first">The constraint matrix is</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\begin{split}A = \begin{bmatrix}
       1 &amp; \ldots &amp; 1 &amp; \ldots &amp; 1 &amp; \ldots &amp; 1\\
       -p_{11} &amp; \ldots &amp; -p_{1K} &amp; \ldots &amp; -p_{I1} &amp; \ldots &amp; -p_{IK}\\
       r_{11}  &amp; \ldots &amp; r_{1K} &amp; \ldots &amp; r_{I1} &amp; \ldots &amp; r_{IK}
   \end{bmatrix}\end{split}\]</div>
</div></blockquote>
<p><strong>Note</strong>: There is a sign change for the second constrain to get the <span class="math notranslate nohighlight">\(\leq\)</span> form.</p>
</li>
<li><p class="first">The constraint vector <span class="math notranslate nohighlight">\(b\)</span> is <span class="math notranslate nohighlight">\(\\(c_1, -c_2, c_3)\)</span>.</p>
</li>
<li><p class="first">The objective vector <span class="math notranslate nohighlight">\(c\)</span> is vectorized version of <span class="math notranslate nohighlight">\(c_{ik}\)</span>.</p>
</li>
</ol>
<p>By changing the maximization to a minimization problem, this now become the standard LP format:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{ll}
  \mbox{Minimize} &amp; - x^T c \\
  \mbox{subject to} &amp; Ax \leq b \\
  &amp; x_i \in \mathcal{C}_i \;\; \text{for all}\; i
\end{array}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{C}_i\)</span> is the unit box.</p>
</div>
<div class="section" id="how-to-formulate-the-training-data">
<h2>How to formulate the training data?<a class="headerlink" href="#how-to-formulate-the-training-data" title="Permalink to this headline">¶</a></h2>
<p>Let's consider a simple dataset. We have 3 emails, each with their predicted utilities. We would like to send less or equal to 2 emails. Keep click &gt;= 1 and disable &lt;= 0.03.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="22%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Email</th>
<th class="head">Psession</th>
<th class="head">Pclick</th>
<th class="head">PDisable</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>0.3</td>
<td>0.4</td>
<td>0.02</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>0.5</td>
<td>0.6</td>
<td>0.01</td>
</tr>
<tr class="row-even"><td>3</td>
<td>0.1</td>
<td>0.1</td>
<td>0.03</td>
</tr>
</tbody>
</table>
<p>The matrix A will be</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
  &amp; 1    &amp;\; 1    &amp;\; 1 \\
  &amp; -0.4  &amp;\; -0.6  &amp;\; -0.1 \\
  &amp; 0.02 &amp;\; 0.01 &amp;\; 0.03 \\
\end{bmatrix}\end{split}\]</div>
<p>The vector b will be (2, -1, 0.03). Vector c will be (-0.3, -0.5, -0.1).
The solver takes ACBlock and vectorB as two inputs. We require the input to be in the <a class="reference internal" href="../interfaces/format.html#input-format"><span class="std std-ref">Input Format</span></a>.</p>
<p>ACBlock:</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">:[[</span><span class="mf">1.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.4</span><span class="p">],[</span><span class="mf">0.02</span><span class="p">]],</span><span class="s2">&quot;c&quot;</span><span class="p">:[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">:[[</span><span class="mf">1.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.6</span><span class="p">],[</span><span class="mf">0.01</span><span class="p">]],</span><span class="s2">&quot;c&quot;</span><span class="p">:[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">:[[</span><span class="mf">1.0</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">],[</span><span class="mf">0.03</span><span class="p">]],</span><span class="s2">&quot;c&quot;</span><span class="p">:[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">]}</span>
</pre></div>
</div>
<p>vectorB:</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;row&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;row&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;row&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="mf">0.03</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-execute-the-solver">
<h2>How to execute the solver?<a class="headerlink" href="#how-to-execute-the-solver" title="Permalink to this headline">¶</a></h2>
<p>Here is a step-by-step tutorial on run a moo solver on your machine.</p>
<div class="section" id="install-spark">
<h3>Install Spark<a class="headerlink" href="#install-spark" title="Permalink to this headline">¶</a></h3>
<p>This step is platform-dependent. On OS X, you can install Spark with Homebrew using the following command:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">brew</span> <span class="n">install</span> <span class="n">apache</span><span class="o">-</span><span class="n">spark</span>
</pre></div>
</div>
<p>For more information, see the <a class="reference external" href="http://spark.apache.org/docs/latest/index.html">Spark docs</a>.</p>
</div>
<div class="section" id="get-and-build-the-code">
<h3>Get and build the code<a class="headerlink" href="#get-and-build-the-code" title="Permalink to this headline">¶</a></h3>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">gradlew</span> <span class="n">build</span>
</pre></div>
</div>
</div>
<div class="section" id="get-the-dataset">
<h3>Get the dataset<a class="headerlink" href="#get-the-dataset" title="Permalink to this headline">¶</a></h3>
<p>A sample unit test dataset of MOO has been prepared under directory data/moo.</p>
</div>
<div class="section" id="run-the-solver">
<h3>Run the solver<a class="headerlink" href="#run-the-solver" title="Permalink to this headline">¶</a></h3>
<p>The solver can be run locally with spark-submit:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>      $SPARK_HOME/bin/spark-submit --packages org.apache.spark:spark-avro_2.11:2.4.0 \
--class com.linkedin.dualip.solver.LPSolverDriver ./dualip/build/libs/dualip_2.11.jar \
      --driver.objectiveClass com.linkedin.dualip.problem.MooSolverDualObjectiveFunction \
      --driver.solverOutputPath output/moo/ \
      --driver.gamma 1E-6 \
      --driver.outputFormat json \
      --driver.projectionType simplex \
      --input.ACblocksPath data/moo/data.json \
      --input.vectorBPath data/moo/budget.json \
      --input.metadataPath data/moo/metaData \
      --input.format json \
      --optimizer.solverType LBFGSB \
      --optimizer.dualTolerance 1E-8 \
      --optimizer.slackTolerance 5E-6 \
      --optimizer.maxIter 100
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-read-the-results-and-do-inference">
<h2>How to read the results and do inference?<a class="headerlink" href="#how-to-read-the-results-and-do-inference" title="Permalink to this headline">¶</a></h2>
<p>There are two scenarios when reading the results. We can directly use the primal as decision variables. This is useful for a static system or batch processing.
Or we can use the dual to recover primal. This is useful when the system is dynamic and there are new items coming in. We can get the primal decision variable
<span class="math notranslate nohighlight">\(x_{ij}\)</span> without even solving the optimization problem. This allows us to work in a low-latency environment as required by most internet applications.</p>
<p>The mechanism of solving such problems in industry is to first solve an extreme-scale problem to generate the duals and then use the duals in a low-latency environment to recover the primal, without the need of solving any optimization problem for every new item that is coming into
the ecosystem.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above method for re-using the dual variable works as long as the score distribution of the new items
matches that of the old items which were used to solve the Problem. To prevent staleness, in practice, the optimization problem is solved at a regular cadence.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="matching.html" class="btn btn-neutral float-right" title="A Matching Problem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Demo" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, LinkedIn

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>