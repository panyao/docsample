

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="scala" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="scala" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>A Matching Problem &mdash; DuaLip 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Citing Dualip" href="../citing/index.html" />
    <link rel="prev" title="A Multi-Objective Optimization Problem" href="moo.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> DuaLip
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../solver/index.html">The Dualip Solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfaces/index.html">Interfaces</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Demo</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="moo.html">A Multi-Objective Optimization Problem</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">A Matching Problem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#an-example-problem">An example problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-translate-the-problem-mathematically">How to translate the problem mathematically?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-formulate-the-training-data">How to formulate the training data?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-execute-the-solver">How to execute the solver?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-spark">Install Spark</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-and-build-the-code">Get and build the code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-the-dataset">Get the dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-the-solver">Run the solver</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-read-the-results">How to read the results?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-do-inference">How to do inference?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../citing/index.html">Citing Dualip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgement/index.html">Acknowledgements</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DuaLip</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Demo</a> &raquo;</li>
        
      <li>A Matching Problem</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/demo/matching.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="a-matching-problem">
<h1>A Matching Problem<a class="headerlink" href="#a-matching-problem" title="Permalink to this headline">¶</a></h1>
<p>Large-scale matching problems occur naturally in many two-sided marketplaces. Usually in these settings, there are creators and consumers.
Each item created has an associated budget and the problem is to maximize the utility under budget constraints.
For example, in the ads marketplace, each ad campaign has a budget and we need to distribute impressions appropriately.
For the jobs marketplace, each paid job has a budget and the impressions need to be appropriately allocated to maximize job applies.
Here we work with a simple example to showcase how we can formulate and solve such matching problems through Dualip.</p>
<div class="section" id="an-example-problem">
<h2>An example problem<a class="headerlink" href="#an-example-problem" title="Permalink to this headline">¶</a></h2>
<p>For <a class="reference external" href="https://grouplens.org/datasets/movielens/">&quot;MovieLens dataset&quot;</a> (<a class="reference external" href="https://dl.acm.org/doi/10.1145/2827872">Harper et. al. 2015</a>), which contains user rating of movies, let us imagine, we want to recommend movies to users,
such that we maximize the total expected ratings, while restricting the number of times a movie is recommended. Similar
such problems have been framed in <a class="reference external" href="https://dl.acm.org/doi/10.14778/2536360.2536362">Makari et. al. (2013)</a>.</p>
</div>
<div class="section" id="how-to-translate-the-problem-mathematically">
<h2>How to translate the problem mathematically?<a class="headerlink" href="#how-to-translate-the-problem-mathematically" title="Permalink to this headline">¶</a></h2>
<p>To translate this problem mathematically, let us begin with some notation. Define</p>
<ul class="simple">
<li><span class="math notranslate nohighlight">\(x_{ik}\)</span>: Probability of recommmending movie <span class="math notranslate nohighlight">\(k\)</span> to user <span class="math notranslate nohighlight">\(i\)</span>.</li>
<li><span class="math notranslate nohighlight">\(c_{ik}\)</span>: Movie rating of movie <span class="math notranslate nohighlight">\(k\)</span> by user <span class="math notranslate nohighlight">\(i\)</span>.</li>
<li><span class="math notranslate nohighlight">\(b_{k}\)</span>: Maximum number of times movie <span class="math notranslate nohighlight">\(k\)</span> can be recommended.</li>
</ul>
<p>Based on this notation, the above problem can be formulated mathematically as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{ll}
  \mbox{Maximize} &amp; \sum_{i,k} x_{i,k} c_{i,k} \\
  \mbox{subject to} &amp; \sum_i x_{i,k} \leq b_k \;\; \text{for all}\;\; k = 1,\ldots, K \\
  &amp; \sum_{k} x_{i,k} \leq 1, \;\; \text{and} \;\; 0 \leq x_{i,k} \leq 1 \;\; \text{for all}\; i,k
\end{array}\end{split}\]</div>
<p>We can further frame this in the vector matrix notation by writing <span class="math notranslate nohighlight">\(x,b,c\)</span> as the vectorized version of <span class="math notranslate nohighlight">\(x_{i,k},b_k,c_{i,k}\)</span>
respectively, with <span class="math notranslate nohighlight">\(x_i = (x_{i,1}, \ldots, x_{i,K})\)</span>. Under this notation and changing the maximization to a
minimization problem, we have</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{ll}
  \mbox{Minimize} &amp; - x^T c \\
  \mbox{subject to} &amp; Ax \leq b \\
  &amp; x_i \in \mathcal{C}_i \;\; \text{for all}\; i
\end{array}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{C}_i\)</span> is the closed simplex defined as</p>
<div class="math notranslate nohighlight">
\[\mathcal{C}_i = \big\{ x \in \mathbb{R}^K : x_1 + ... + x_K \leq 1, \;\; x_k \geq 0\big\}\]</div>
<p>and <span class="math notranslate nohighlight">\(A_{K \times IK}\)</span> is the matrix that encodes the <span class="math notranslate nohighlight">\(K\)</span> movie limit constraints.</p>
</div>
<div class="section" id="how-to-formulate-the-training-data">
<h2>How to formulate the training data?<a class="headerlink" href="#how-to-formulate-the-training-data" title="Permalink to this headline">¶</a></h2>
<p>Let's consider a simple dataset. We have 4 users and 3 movies, each with their given rating.</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="36%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">UserID</th>
<th class="head">MovieId</th>
<th class="head">Rating</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="row-even"><td>1</td>
<td>3</td>
<td>NA</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>1</td>
<td>NA</td>
</tr>
<tr class="row-even"><td>2</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>3</td>
<td>2</td>
</tr>
<tr class="row-even"><td>3</td>
<td>1</td>
<td>NA</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="row-even"><td>3</td>
<td>3</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="row-even"><td>4</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>3</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>The matrix A will be</p>
<div class="math notranslate nohighlight">
\[\begin{split}A =
\begin{bmatrix}
  1 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;1 &amp;0 &amp;0 \\
  0 &amp;1 &amp;0 &amp;0 &amp;1 &amp;0 &amp;0 &amp;1 &amp;0 &amp;0 &amp;1 &amp;0 \\
  0 &amp;0 &amp;0 &amp;0 &amp;0 &amp;1 &amp;0 &amp;0 &amp;1 &amp;0 &amp;0 &amp;1 \\
\end{bmatrix}\end{split}\]</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many matching problems, the connections are very sparse, i.e. users only rate a small percentage of movies. If user i does not rate movie k, the corresponding entry in A should be 0 because it will not contribute to the objective value. ACBlock only record the non-zero entries.</p>
</div>
<p>The vector b will be (1, 1, 1). Vector c will be (-3, -4, 0, 0, -1, -2, 0, -2, -1, -2, -4, -3)</p>
<p>The solver takes ACBlock and vectorB as two inputs. We require the input to be in the <a class="reference internal" href="../interfaces/format.html#input-format"><span class="std std-ref">Input Format</span></a>.</p>
<p>The format of ACBlock:</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;string&quot;</span> <span class="p">]</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
      <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span>
      <span class="s2">&quot;items&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;record&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fields&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;rowId&quot;</span><span class="p">,</span>
          <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;int&quot;</span>
        <span class="p">},</span> <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span>
          <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;double&quot;</span>
        <span class="p">},</span> <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
          <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;double&quot;</span>
        <span class="p">}</span> <span class="p">]</span>
      <span class="p">}</span> <span class="p">]</span>
    <span class="p">}</span> <span class="p">]</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>Here id is a unique identifier of the block, i.e. user id for this problem. Each id correspond to an array of tuple, which is in the format of (rowId, c(rowId), a(rowId)). rowId correspond to movieId in this problem.</p>
<p>ACBlock in json format:</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">:[[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">:[[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">:[[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">:[[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]}</span>
</pre></div>
</div>
<p>vectorB in json format:</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;row&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;row&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;row&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-execute-the-solver">
<h2>How to execute the solver?<a class="headerlink" href="#how-to-execute-the-solver" title="Permalink to this headline">¶</a></h2>
<p>Here is a step-by-step tutorial on run a matching solver on your machine.</p>
<div class="section" id="install-spark">
<h3>Install Spark<a class="headerlink" href="#install-spark" title="Permalink to this headline">¶</a></h3>
<p>This step is platform-dependent. On OS X, you can install Spark with Homebrew using the following command:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">brew</span> <span class="n">install</span> <span class="n">apache</span><span class="o">-</span><span class="n">spark</span>
</pre></div>
</div>
<p>For more information, see the <a class="reference external" href="http://spark.apache.org/docs/latest/index.html">Spark docs</a>.</p>
</div>
<div class="section" id="get-and-build-the-code">
<h3>Get and build the code<a class="headerlink" href="#get-and-build-the-code" title="Permalink to this headline">¶</a></h3>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">gradlew</span> <span class="n">build</span>
</pre></div>
</div>
</div>
<div class="section" id="get-the-dataset">
<h3>Get the dataset<a class="headerlink" href="#get-the-dataset" title="Permalink to this headline">¶</a></h3>
<p>To download the 20M <a class="reference external" href="https://grouplens.org/datasets/movielens/">MovieLens dataset</a></p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">O</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">files</span><span class="o">.</span><span class="n">grouplens</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">movielens</span><span class="o">/</span><span class="n">ml</span><span class="o">-</span><span class="mi">20</span><span class="n">m</span><span class="o">.</span><span class="n">zip</span>
<span class="n">unzip</span> <span class="n">ml</span><span class="o">-</span><span class="mi">20</span><span class="n">m</span><span class="o">.</span><span class="n">zip</span>
<span class="n">mkdir</span> <span class="n">data</span>
<span class="n">mv</span> <span class="n">rating</span><span class="o">.</span><span class="n">csv</span> <span class="n">data</span><span class="o">/</span>
</pre></div>
</div>
<p>Then use MatchingDataGenerator to convert the dataset to the format solver take:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>$SPARK_HOME/bin/spark-submit --packages org.apache.spark:spark-avro_2.11:2.4.0 --class com.linkedin.dualip.preprocess.MatchingDataGenerator ./dualip/build/libs/dualip_2.11.jar \
--preprocess.dataBasePath data/ml-20m/ \
--preprocess.dataFormat csv \
--preprocess.dataBlockDim userId \
--preprocess.constraintDim movieId \
--preprocess.budgetDim budget \
--preprocess.budgetValue 30 \
--preprocess.rewardDim rating \
--preprocess.costGenerator constant \
--preprocess.costValue 1.0 \
--preprocess.outputPath data/movielens/
</pre></div>
</div>
<p>Here rewardDim is the column name corresponding to reward information <span class="math notranslate nohighlight">\(c_{ij}\)</span>.
dataBlockDim is the column name corresponding to dataBlockId (i). constraintDim is the column name corresponding to itemId (j).
budgetValue is budget information <span class="math notranslate nohighlight">\(b_{k}\)</span>.</p>
</div>
<div class="section" id="run-the-solver">
<h3>Run the solver<a class="headerlink" href="#run-the-solver" title="Permalink to this headline">¶</a></h3>
<p>The solver can be run locally with spark-submit:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>$SPARK_HOME/bin/spark-submit --packages org.apache.spark:spark-avro_2.11:2.4.0 \
--class com.linkedin.dualip.solver.LPSolverDriver ./dualip/build/libs/dualip_2.11.jar \
--driver.objectiveClass com.linkedin.dualip.problem.MatchingSolverDualObjectiveFunction \
--driver.solverOutputPath /output/matching/ \
--driver.gamma 0.1 \
--driver.outputFormat json \
--driver.projectionType simplexInequality \
--input.ACblocksPath data/movielens/data \
--input.vectorBPath data/movielens/budget \
--input.metadataPath data/movielens/metaData \
--input.format avro \
--matching.slateSize 1 \
--optimizer.solverType LBFGSB \
--optimizer.dualTolerance 1E-8 \
--optimizer.slackTolerance 5E-6 \
--optimizer.maxIter 500
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-read-the-results">
<h2>How to read the results?<a class="headerlink" href="#how-to-read-the-results" title="Permalink to this headline">¶</a></h2>
<p>We can see that as the solver progress, the <code class="code docutils literal notranslate"><span class="pre">dual_obj</span></code> increases and <code class="code docutils literal notranslate"><span class="pre">max_pos_slack</span></code> and <code class="code docutils literal notranslate"><span class="pre">max_zero_slack</span></code> decreases.</p>
<div class="code text highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">------------------------------------------------------------------------</span>
                          <span class="n">Dualip</span> <span class="n">v1</span><span class="o">.</span><span class="mi">0</span>     <span class="mi">2021</span>
             <span class="n">Dual</span> <span class="n">Decomposition</span> <span class="n">based</span> <span class="n">Linear</span> <span class="n">Program</span> <span class="n">Solver</span>
<span class="o">------------------------------------------------------------------------</span>

<span class="n">Optimizer</span><span class="p">:</span> <span class="n">LBFGSB</span> <span class="n">solver</span>
<span class="n">primalUpperBound</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.64155850e+05</span><span class="p">,</span> <span class="n">maxIter</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="n">dualTolerance</span><span class="p">:</span> <span class="mf">1.0E-8</span> <span class="n">slackTolerance</span><span class="p">:</span> <span class="mf">5.0E-6</span>

<span class="nb">iter</span><span class="p">:</span>     <span class="mi">0</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.86709416e+05</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.87890000e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">9.650435e+01</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="mf">0.000000e+00</span>   <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">1.180584e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="o">-</span><span class="n">Infinity</span>        <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">9.650435e+01</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">8.828194e+04</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">8.987</span>
<span class="nb">iter</span><span class="p">:</span>     <span class="mi">1</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.86709416e+05</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.87890000e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">9.650435e+01</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="mf">0.000000e+00</span>   <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">1.180584e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="o">-</span><span class="n">Infinity</span>        <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">9.650435e+01</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">8.828194e+04</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">6.738</span>
<span class="nb">iter</span><span class="p">:</span>     <span class="mi">2</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.26194182e+06</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.19067400e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">3.907679e+01</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="o">-</span><span class="mf">2.646088e+06</span>  <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">3.213506e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="mf">1.680045e+01</span>     <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">3.907679e+01</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">6.284022e+04</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">4.228</span>
<span class="nb">iter</span><span class="p">:</span>     <span class="mi">3</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.44149679e+06</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.24132300e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">3.448183e+01</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="o">-</span><span class="mf">8.206471e+05</span>  <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">3.282595e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="mf">2.642451e+01</span>     <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">3.448183e+01</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">6.233273e+04</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">4.558</span>
<span class="nb">iter</span><span class="p">:</span>     <span class="mi">4</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">8.82622744e+05</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.39467479e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">3.030013e+01</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="o">-</span><span class="mf">2.466456e+05</span>  <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">3.490308e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="mf">2.471272e+01</span>     <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">3.030013e+01</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">6.188493e+04</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">4.206</span>
<span class="nb">iter</span><span class="p">:</span>     <span class="mi">5</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">7.22368086e+05</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.58265033e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">2.397677e+01</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="o">-</span><span class="mf">6.780186e+04</span>  <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">3.698804e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="mf">2.397677e+01</span>     <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">2.053982e+01</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">6.032372e+04</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">4.321</span>
<span class="nb">iter</span><span class="p">:</span>     <span class="mi">6</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.82631528e+05</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.72533898e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">1.847038e+01</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="o">-</span><span class="mf">1.381724e+04</span>  <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">3.719608e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="mf">1.847038e+01</span>     <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">8.919135e+00</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">5.726833e+04</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">4.120</span>
<span class="nb">iter</span><span class="p">:</span>     <span class="mi">7</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.82631528e+05</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.72533898e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">1.847038e+01</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="o">-</span><span class="mf">1.381724e+04</span>  <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">3.719608e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="mf">1.847038e+01</span>     <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">8.919135e+00</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">5.726833e+04</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">4.442</span>
<span class="nb">iter</span><span class="p">:</span>     <span class="mi">8</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.82631528e+05</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.72533898e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">1.847038e+01</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="o">-</span><span class="mf">1.381724e+04</span>  <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">3.719608e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="mf">1.847038e+01</span>     <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">8.919135e+00</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">5.726833e+04</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">4.235</span>
<span class="nb">iter</span><span class="p">:</span>     <span class="mi">9</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.70900248e+05</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.73704610e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">1.584054e+01</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="o">-</span><span class="mf">1.984704e+03</span>  <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">4.789067e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="mf">1.584054e+01</span>     <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">1.676255e+00</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">4.087020e+04</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">3.694</span>
<span class="nb">iter</span><span class="p">:</span>    <span class="mi">10</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.70900248e+05</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.73704610e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">1.584054e+01</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="o">-</span><span class="mf">1.984704e+03</span>  <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">4.789067e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="mf">1.584054e+01</span>     <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">1.676255e+00</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">4.087020e+04</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">3.596</span>
</pre></div>
</div>
<p>The solver converges after 413 iterations, while the combined number of iterations (including the
internal iterations of LBFGS) is 1293. We also show the final dual and primal objectives, as well
as the number of active constraints in the problem.</p>
<div class="code text highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">iter</span><span class="p">:</span>  <span class="mi">1290</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.28011839e+05</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.32627842e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">1.289256e-02</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="o">-</span><span class="mf">5.876918e+00</span>  <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">4.621880e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="mf">1.813359e-02</span>     <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">0.000000e+00</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">1.094879e+01</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">4.170</span>
<span class="nb">iter</span><span class="p">:</span>  <span class="mi">1291</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.28011839e+05</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.32660904e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">9.317112e-02</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="mf">2.721294e+01</span>   <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">4.621852e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="mf">9.317112e-02</span>     <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">0.000000e+00</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">1.918328e+01</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">3.758</span>
<span class="nb">iter</span><span class="p">:</span>  <span class="mi">1292</span>     <span class="n">dual_obj</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.28011839e+05</span>       <span class="n">cx</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.32660904e+05</span>     <span class="n">feasibility</span><span class="p">:</span> <span class="mf">9.317112e-02</span>       <span class="n">λ</span><span class="p">(</span><span class="n">Ax</span><span class="o">-</span><span class="n">b</span><span class="p">):</span> <span class="mf">2.721294e+01</span>   <span class="n">γ</span><span class="o">||</span><span class="n">x</span><span class="o">||/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">4.621852e+03</span>  <span class="n">max_pos_slack</span><span class="p">:</span> <span class="mf">9.317112e-02</span>     <span class="n">max_zero_slack</span><span class="p">:</span> <span class="mf">0.000000e+00</span>    <span class="n">abs_slack_sum</span><span class="p">:</span> <span class="mf">1.918328e+01</span>     <span class="n">time</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span> <span class="mf">3.855</span>
<span class="n">Total</span> <span class="n">LBFGS</span> <span class="n">iterations</span><span class="p">:</span> <span class="mi">413</span>
<span class="n">Status</span><span class="p">:</span><span class="n">Converged</span>
<span class="n">Total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span><span class="p">:</span> <span class="mi">1293</span>
<span class="n">Primal</span><span class="p">:</span> <span class="o">-</span><span class="mf">628012.671815458</span>
<span class="n">Dual</span><span class="p">:</span> <span class="o">-</span><span class="mf">628011.8409963399</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">Active</span> <span class="n">Constraints</span><span class="p">:</span> <span class="mi">2992</span>
</pre></div>
</div>
<p>The detailed log is given <a class="reference internal" href="../logs/matching.html#matching-log"><span class="std std-ref">here</span></a>.</p>
</div>
<div class="section" id="how-to-do-inference">
<h2>How to do inference?<a class="headerlink" href="#how-to-do-inference" title="Permalink to this headline">¶</a></h2>
<p>There are two scenarios when reading the results. We can directly use the primal as decision variables. This is useful for a static system or batch processing.
Or we can use the dual to recover primal. This is useful when the system is dynamic and there are new items coming in. We can get the primal decision variable
<span class="math notranslate nohighlight">\(x_{ij}\)</span> without even solving the optimization problem. This allows us to work in a low-latency environment as required by most internet applications.</p>
<p>The mechanism of solving such problems in industry is to first solve an extreme-scale problem to generate the duals and then use the duals in a
low-latency environment to recover the primal, without the need of solving any optimization problem for every new item that is coming into
the ecosystem.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above method for re-using the dual variable works as long as the score distribution of the new items
matches that of the old items which were used to solve the Problem. To prevent staleness, in practice, the optimization problem is solved at a regular cadence.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../citing/index.html" class="btn btn-neutral float-right" title="Citing Dualip" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="moo.html" class="btn btn-neutral" title="A Multi-Objective Optimization Problem" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, LinkedIn

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>